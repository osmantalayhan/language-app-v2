<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1.0">
    <title>{{ word.english }} - WordSpace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/clash-display" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #fff;
        }
        
        /* Custom Modal */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }
        
        .modal-backdrop.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .modal-content {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 400px;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }

        /* Minimalist Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            pointer-events: none;
        }

        .toast {
            background: rgba(20, 20, 20, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 8px;
            min-width: 280px;
            max-width: 360px;
            backdrop-filter: blur(10px);
            transform: translateX(400px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            pointer-events: auto;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.success {
            border-left: 3px solid #10b981;
        }

        .toast.warning {
            border-left: 3px solid #f59e0b;
        }

        .toast.error {
            border-left: 3px solid #ef4444;
        }

        .toast-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .toast-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background: #10b981;
            color: #000;
        }

        .toast.warning .toast-icon {
            background: #f59e0b;
            color: #000;
        }

        .toast.error .toast-icon {
            background: #ef4444;
            color: #fff;
        }

        .toast-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.9);
        }

        .toast-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .toast-close:hover {
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.1);
        }

        
        .modal-backdrop.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-title {
            font-family: 'Clash Display', sans-serif;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .modal-body {
            margin-bottom: 24px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 15px;
            line-height: 1.5;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        .modal-btn-cancel {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-btn-cancel:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .modal-btn-delete {
            background: transparent;
            color: rgba(239, 68, 68, 0.9);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-btn-delete:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .noise {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj48ZmlsdGVyIGlkPSJhIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iLjc1IiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSIzMDAiIGZpbHRlcj0idXJsKCNhKSIgb3BhY2l0eT0iLjA1Ii8+PC9zdmc+');
            pointer-events: none;
            z-index: 1; /* Reduced z-index */
            opacity: 0.2; /* Reduced opacity */
            mix-blend-mode: multiply; /* Changed blend mode */
        }
        .gradient-sphere {
            position: absolute;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(255,255,255,0.03) 0%, rgba(0,0,0,0) 70%);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            mix-blend-mode: plus-lighter;
        }
        .clash-display {
            font-family: 'Clash Display', sans-serif;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .btn-primary {
            background: #fff;
            color: #000;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-primary:hover {
            opacity: 0.9;
        }
        .btn-secondary {
            background: transparent;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .btn-danger {
            background: transparent;
            color: rgba(239, 68, 68, 0.9);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
        .action-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        .example-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .example-card:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        /* Skeleton Loading Animation */
        .skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-line {
            height: 16px;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        
        .skeleton-line:last-child {
            margin-bottom: 0;
            width: 60%;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Noise Texture -->
    <div class="noise"></div>

    <!-- Gradient Spheres -->
    <div class="gradient-sphere" style="top: 20%; left: 30%;"></div>
    <div class="gradient-sphere" style="top: 60%; left: 70%;"></div>

    <div class="container mx-auto px-4 py-8 relative z-10 min-w-[1200px]">
        <div class="main-layout grid grid-cols-[220px_1fr] gap-8">
            {% include 'sidebar.html' %}

            <!-- Main Content -->
            <div class="content-area bg-white/[0.03] border border-white/10 rounded-xl p-6">
                <!-- Back Button -->
                <a href="{{ url_for('dashboard') }}" class="inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors mb-8 btn-secondary px-4 py-2 rounded-lg">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Kelimelerime Dön
                </a>

                <!-- Word Card -->
                <div class="glass-card rounded-2xl p-8 mb-8">
                    <div class="flex flex-row justify-between items-start gap-6 mb-8">
                        <div class="flex-1">
                            <div class="flex items-center gap-4 mb-4">
                                <h1 class="clash-display text-4xl font-semibold">{{ word.english }}</h1>
                                <button onclick="playAudio('{{ word.english }}')" class="btn-secondary p-2 rounded-lg">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                                    </svg>
                                </button>
                            </div>
                            <p class="text-xl text-gray-400 mb-4">{{ word.turkish }}</p>
                            <div class="flex flex-wrap gap-3">
                                <span class="px-3 py-1 rounded-full text-sm bg-white/10 text-white border border-white/20">
                                    Level {{ word.level }}
                                </span>
                                {% if word.mastered %}
                                <span class="px-3 py-1 rounded-full text-sm bg-white/10 text-white border border-white/20">
                                    Mastered
                                </span>
                                {% endif %}
                                {% if word.pronunciation %}
                                <span class="px-3 py-1 rounded-full text-sm bg-white/10 text-gray-300 border border-white/20 font-mono">
                                    {{ word.pronunciation }}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="flex flex-col gap-3 min-w-[200px] items-end">
                            <!-- Added Date -->
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-sm text-white/50 font-medium">{{ formatted_date }}</span>
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-white/40">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                    <line x1="16" y1="2" x2="16" y2="6"/>
                                    <line x1="8" y1="2" x2="8" y2="6"/>
                                    <line x1="3" y1="10" x2="21" y2="10"/>
                                </svg>
                            </div>
                            
                            {% if added_by_user %}
                            <!-- Added By -->
                            <div class="flex items-center gap-2 justify-end">
                                <span class="text-sm text-white/50 font-medium">{{ added_by_user.username }}</span>
                                <div class="w-5 h-5 bg-white/10 rounded flex items-center justify-center text-xs font-medium text-white/70">
                                    {{ added_by_user.username[0].upper() }}
                                </div>
                            </div>
                            {% endif %}
                            
                            <div class="flex gap-2 mt-4">
                                {% if not word.mastered %}
                                <button onclick="markMastered({{ word.id }})" class="icon-btn" title="Öğrendim">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"/>
                                        <circle cx="12" cy="12" r="10"/>
                                    </svg>
                                </button>
                                {% else %}
                                <button onclick="markForReview({{ word.id }})" class="icon-btn" title="Tekrar Et">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                </button>
                                {% endif %}
                                
                                <button id="save-word-btn" onclick="toggleSaveWord({{ word.id }})" class="icon-btn" title="Kaydet">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                                    </svg>
                                </button>
                                
                                <button onclick="deleteWord({{ word.id }})" class="icon-btn" title="Sil" style="color: rgba(239, 68, 68, 0.8);">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Example Sentences -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-lg font-semibold flex items-center gap-2">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                </svg>
                                Example Sentences
                            </h2>
                            <button onclick="regenerateExamples()" class="btn-secondary action-button text-sm">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 4v6h-6"/>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                </svg>
                                Yeniden Üret
                            </button>
                        </div>
                        <div class="space-y-4" id="example-sentences">
                            {% if examples and examples|length > 0 %}
                                {% for i in range(0, examples|length, 2) %}
                                    <div class="example-card rounded-lg p-4">
                                        <p class="text-white mb-2">{{ examples[i] }}</p>
                                        {% if i+1 < examples|length %}
                                            <p class="text-gray-400 text-sm">{{ examples[i+1] }}</p>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="example-card rounded-lg p-4">
                                    <p class="text-gray-400">Örnek cümleler yükleniyor...</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Sentence Exercise -->
                    <div class="mb-8">
                        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                                <line x1="16" y1="13" x2="8" y2="13"/>
                                <line x1="16" y1="17" x2="8" y2="17"/>
                                <polyline points="10,9 9,9 8,9"/>
                            </svg>
                            Cümle Egzersizi
                        </h2>
                        <div class="example-card rounded-lg p-6" id="sentence-exercise">
                            <div class="mb-4">
                                <p class="text-gray-400 text-sm mb-2">Bu kelimeyi kullanarak bir cümle yazın:</p>
                                <p class="text-white text-lg mb-2 font-semibold">{{ word.english }}</p>
                                <p class="text-gray-400 text-sm mb-4">{{ word.turkish }}</p>
                            </div>
                            
                            <div class="mb-4">
                                <textarea 
                                    id="user-sentence" 
                                    placeholder="write an example sentence"
                                    class="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white placeholder-gray-500 resize-none focus:outline-none focus:border-white/20 focus:bg-white/8"
                                    rows="3"></textarea>
                            </div>
                            
                            <div class="flex gap-3 mb-4">
                                <button onclick="analyzeSentence()" class="btn-primary action-button">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"/>
                                        <circle cx="12" cy="12" r="10"/>
                                    </svg>
                                    Analiz Et
                                </button>
                                <button onclick="getSuggestion()" class="btn-secondary action-button">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="10"/>
                                        <path d="M12 16v-4"/>
                                        <path d="M12 8h.01"/>
                                    </svg>
                                    Öneri Al
                                </button>
                                <button onclick="clearSentence()" class="btn-secondary action-button">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                    </svg>
                                    Temizle
                                </button>
                            </div>
                            
                            <div id="exercise-result" class="hidden">
                                <div class="border-t border-white/10 pt-4">
                                    <div id="result-content"></div>
                                    <div id="share-section" class="hidden mt-4">
                                        <button onclick="shareSentence()" class="btn-primary action-button">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                                                <polyline points="16,6 12,2 8,6"/>
                                                <line x1="12" y1="2" x2="12" y2="15"/>
                                            </svg>
                                            Cümleyi Paylaş
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shared Sentences Section -->
                    <div class="mb-8">
                        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
                            </svg>
                            Kullanıcı Cümleleri
                        </h2>
                        <div class="space-y-3" id="shared-sentences">
                            <div class="example-card rounded-lg p-4">
                                <div class="text-center py-4">
                                    <div class="w-10 h-10 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-2">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-500">
                                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
                                        </svg>
                                    </div>
                                    <p class="text-gray-400 text-sm">Henüz paylaşılan cümle yok.</p>
                                    <p class="text-gray-500 text-xs mt-1">İlk sen ol!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Related Words -->
            {% if related_words %}
            <div>
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
                    </svg>
                    Related Words
                </h2>
                <div class="grid grid-cols-3 gap-4">
                    {% for related in related_words %}
                    <a href="{{ url_for('word_detail', word_id=related.id) }}" class="example-card rounded-lg p-4 hover:scale-[1.02] transition-transform">
                        <h3 class="font-medium mb-1">{{ related.english }}</h3>
                        <p class="text-sm text-gray-400">{{ related.turkish }}</p>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-title">Kelimeyi Sil</div>
            <div class="modal-body">
                Bu kelimeyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.
            </div>
            <div class="modal-actions">
                <button id="modal-cancel" class="modal-btn-cancel">İptal</button>
                <button id="modal-delete" class="modal-btn-delete">Sil</button>
            </div>
        </div>
    </div>

    <!-- Delete Sentence Confirmation Modal -->
    <div id="delete-sentence-modal" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-title">Cümleyi Sil</div>
            <div class="modal-body">
                Bu cümleyi silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.
            </div>
            <div class="modal-actions">
                <button id="sentence-modal-cancel" class="modal-btn-cancel">İptal</button>
                <button id="sentence-modal-delete" class="modal-btn-delete">Sil</button>
            </div>
        </div>
    </div>

    <script>
        // Examples are now loaded server-side, no need for initial AJAX call
        document.addEventListener('DOMContentLoaded', function() {
            
            // Ensure all modals are closed on page load
            const modals = document.querySelectorAll('.modal-backdrop');
            modals.forEach(modal => {
                modal.classList.remove('active');
                modal.style.display = 'none';
            });
            
            // Reset any potential z-index issues
            document.body.style.overflow = 'auto';
            
            // Load shared sentences
            loadSharedSentences();
            
            // Kaydedilmiş durumunu kontrol et ve ayarla
            checkSavedStatus();
        });

        function analyzeSentence() {
            const userSentence = document.getElementById('user-sentence').value.trim();
            const currentWord = document.querySelector('h1').textContent.toLowerCase();
            const wordId = {{ word.id }};
            
            if (!userSentence) {
                showResult('Lütfen bir cümle yazın.', 'error');
                return;
            }
            
            // Check if the sentence contains the word
            const containsWord = userSentence.toLowerCase().includes(currentWord);
            
            if (!containsWord) {
                showResult(`
                    <div class="text-red-400 mb-2">⚠ Cümlenizde "${currentWord}" kelimesi bulunamadı.</div>
                    <div class="text-gray-400 text-sm">Lütfen bu kelimeyi kullanarak bir cümle yazın.</div>
                `, 'error');
                return;
            }
            
            // Show skeleton loading state
            showResult(`
                <div class="text-white mb-3 font-medium">Cümleniz analiz ediliyor...</div>
                <div class="bg-white/5 border border-white/10 rounded-lg p-4 mb-3">
                    <div class="skeleton skeleton-line"></div>
                    <div class="skeleton skeleton-line"></div>
                    <div class="skeleton skeleton-line"></div>
                    <div class="skeleton skeleton-line"></div>
                </div>
                <div class="text-gray-400 text-sm">Lütfen bekleyin...</div>
            `, 'info');
            
            // Send to backend for real AI analysis
            fetch('/analyze_sentence', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    sentence: userSentence,
                    word: currentWord,
                    word_id: wordId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Display the real AI analysis
                    const analysis = data.analysis;
                    
                    // Determine if it's positive or negative feedback
                    const isPositive = analysis.includes('Tebrikler') || analysis.includes('güzel kullanmışsınız');
                    const hasErrors = analysis.includes('düzeltme yapalım') || analysis.includes('Doğru cümle:');
                    
                    let resultClass = 'text-white';
                    let resultTitle = 'Analiz Sonucu';
                    let score = 100;
                    
                    if (hasErrors) {
                        resultClass = 'text-white';
                        resultTitle = 'Öğretmen Geri Bildirimi';
                        score = 70;
                    } else if (isPositive) {
                        resultClass = 'text-white';
                        resultTitle = 'Harika!';
                        score = 95;
                    }
                    
                    // Format the analysis text - highlight important parts naturally
                    let formattedAnalysis = analysis
                        .replace(/Doğru cümle:/g, '<span class="font-medium">Doğru cümle:</span>')
                        .replace(/Türkçesi:/g, '<span class="font-medium">Türkçesi:</span>')
                        .replace(/Bu tür cümlelerde dikkat edilmesi gereken:/g, '<span class="font-medium">Bu tür cümlelerde dikkat edilmesi gereken:</span>')
                        .replace(/Tebrikler!/g, '<span class="font-medium">Tebrikler!</span>');
                    
                    showResult(`
                        <div class="${resultClass} mb-3 font-semibold">${resultTitle}</div>
                        <div class="bg-white/5 border border-white/10 rounded-lg p-4 mb-3">
                            <div class="text-white whitespace-pre-line leading-relaxed">${formattedAnalysis}</div>
                        </div>
                        <div class="text-gray-400 text-xs">AI öğretmen tarafından analiz edildi</div>
                    `, score >= 75 ? 'success' : 'info');
                    
                    // Show share button if analysis is positive
                    const shareSection = document.getElementById('share-section');
                    if (score >= 75) {
                        shareSection.classList.remove('hidden');
                    } else {
                        shareSection.classList.add('hidden');
                    }
                } else {
                    // Show error message
                    showResult(`
                        <div class="text-red-400 mb-2">Analiz başarısız</div>
                        <div class="text-gray-400 text-sm">${data.error || 'Bir hata oluştu, lütfen tekrar deneyin'}</div>
                    `, 'error');
                }
            })
            .catch(error => {
                console.error('Error analyzing sentence:', error);
                showResult(`
                    <div class="text-red-400 mb-2">Bağlantı hatası</div>
                    <div class="text-gray-400 text-sm">Lütfen internet bağlantınızı kontrol edin ve tekrar deneyin</div>
                `, 'error');
            });
        }

        function getSuggestion() {
            const currentWord = document.querySelector('h1').textContent;
            const currentTranslation = document.querySelector('p.text-2xl').textContent.split(',')[0];
            
            const suggestions = [
                `I use my ${currentWord.toLowerCase()} every day.`,
                `The ${currentWord.toLowerCase()} is very useful.`,
                `Can you help me with this ${currentWord.toLowerCase()}?`,
                `I bought a new ${currentWord.toLowerCase()} yesterday.`,
                `This ${currentWord.toLowerCase()} belongs to me.`,
                `I need to find my ${currentWord.toLowerCase()}.`
            ];
            
            const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
            
            showResult(`
                <div class="text-white mb-3 font-medium">Öneri</div>
                <div class="text-white bg-white/5 border border-white/10 rounded-lg p-4 mb-3">${randomSuggestion}</div>
                <div class="text-gray-400 text-sm">Bu örneği referans alarak kendi cümlenizi yazabilirsiniz.</div>
            `, 'info');
        }

        function clearSentence() {
            document.getElementById('user-sentence').value = '';
            document.getElementById('exercise-result').classList.add('hidden');
        }

        function showResult(content, type) {
            const resultDiv = document.getElementById('exercise-result');
            const resultContent = document.getElementById('result-content');
            
            resultContent.innerHTML = content;
            resultDiv.classList.remove('hidden');
        }

        function playAudio(word) {
            try {
                // Web Speech API kullan (tarayıcı desteği)
                if ('speechSynthesis' in window) {
                    // Önce konuşmayı durdur
                    speechSynthesis.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(word);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.8; // Biraz yavaş konuş
                    utterance.pitch = 1.0;
                    utterance.volume = 1.0;
                    
                    speechSynthesis.speak(utterance);
                } else {
                    // Fallback: Edge TTS servisi dene
                    fetch(`/speak/${encodeURIComponent(word)}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Audio service unavailable');
                            }
                            return response.blob();
                        })
                        .then(blob => {
                            const audio = new Audio(URL.createObjectURL(blob));
                            audio.play();
                        })
                        .catch(error => {
                            console.error('Error playing audio:', error);
                            alert('Ses çalma servisi şu anda kullanılamıyor. Lütfen daha sonra tekrar deneyin.');
                        });
                }
            } catch (error) {
                console.error('Error in playAudio function:', error);
                alert('Ses çalma işleminde bir hata oluştu.');
            }
        }

        function markMastered(wordId) {
            fetch(`/mark_mastered/${wordId}`, {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                }
            })
            .catch(error => console.error('Error marking as mastered:', error));
        }

        function markForReview(wordId) {
            fetch(`/mark_review/${wordId}`, {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.reload();
                }
            })
            .catch(error => console.error('Error marking for review:', error));
        }

        function deleteWord(wordId) {
            // Show the modal
            const modal = document.getElementById('delete-modal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
            
            // Set up event listeners
            document.getElementById('modal-cancel').onclick = function() {
                modal.classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 200);
            };
            
            document.getElementById('modal-delete').onclick = function() {
                // Hide the modal
                modal.classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 200);
                
                // Delete the word
                fetch(`/delete_word/${wordId}`, {
                    method: 'POST',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = '/dashboard';
                    } else {
                        // Show error message
                        alert('Kelime silinirken hata oluştu: ' + (data.error || 'Bilinmeyen hata'));
                    }
                })
                .catch(error => {
                    console.error('Error deleting word:', error);
                    alert('Bağlantı hatası. Lütfen tekrar deneyin.');
                });
            };
        }

        function shareSentence() {
            const userSentence = document.getElementById('user-sentence').value.trim();
            const wordId = {{ word.id }};
            
            // Send to backend
            fetch('/share_sentence', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    sentence: userSentence,
                    word_id: wordId
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showResult(`
                        <div class="text-green-400 mb-2">Cümleniz başarıyla paylaşıldı!</div>
                        <div class="text-gray-400 text-sm">Diğer kullanıcılar artık cümlenizi görebilir.</div>
                    `, 'success');
                    
                    // Hide share button
                    document.getElementById('share-section').classList.add('hidden');
                    
                    // Reload shared sentences
                    loadSharedSentences();
                } else {
                    showResult(`
                        <div class="text-red-400 mb-2">❌ Paylaşım başarısız</div>
                        <div class="text-gray-400 text-sm">${data.error || 'Bir hata oluştu'}</div>
                    `, 'error');
                }
            })
            .catch(error => {
                console.error('Error sharing sentence:', error);
                showResult(`
                    <div class="text-red-400 mb-2">❌ Bağlantı hatası</div>
                    <div class="text-gray-400 text-sm">Lütfen tekrar deneyin</div>
                `, 'error');
            });
        }

        function loadSharedSentences() {
            const wordId = {{ word.id }};
            
            fetch(`/get_shared_sentences/${wordId}`)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('shared-sentences');
                    
                    if (data.success && data.sentences && data.sentences.length > 0) {
                        container.innerHTML = '';
                        
                        data.sentences.forEach(item => {
                            const div = document.createElement('div');
                            div.className = 'example-card rounded-lg p-4 hover:bg-white/3 transition-all duration-200';
                            
                            // Generate simple initials
                            const initials = item.username.substring(0, 1).toUpperCase();
                            
                            // Check if current user owns this sentence
                            const isOwner = item.user_id === {{ current_user.id if current_user.is_authenticated else 'null' }};
                            
                            div.innerHTML = `
                                <div class="flex items-start gap-3">
                                    <!-- Simple Profile -->
                                    <div class="flex-shrink-0">
                                        <div class="w-8 h-8 bg-white/10 rounded-md flex items-center justify-center text-white text-xs font-medium">
                                            ${initials}
                                        </div>
                                    </div>
                                    
                                    <!-- Content -->
                                    <div class="flex-1 min-w-0">
                                        <!-- User Info -->
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <span class="text-sm text-white font-medium">${item.username}</span>
                                                <span class="text-xs text-gray-500">${item.created_at}</span>
                                            </div>
                                            ${isOwner ? `
                                                <button onclick="deleteSharedSentence(${item.id})" class="text-gray-500 hover:text-red-400 transition-colors p-1">
                                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                                    </svg>
                                                </button>
                                            ` : ''}
                                        </div>
                                        
                                        <!-- Sentence -->
                                        <p class="text-gray-300 text-sm mb-3 leading-relaxed">${item.sentence}</p>
                                        
                                        <!-- Actions -->
                                        <div class="flex items-center gap-4">
                                            <button onclick="likeSentence(${item.id})" class="flex items-center gap-1 text-gray-500 hover:text-gray-300 transition-colors text-xs">
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                                                </svg>
                                                <span>${item.likes || 0}</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                            
                            container.appendChild(div);
                        });
                    } else {
                        container.innerHTML = `
                            <div class="example-card rounded-lg p-4">
                                <div class="text-center py-4">
                                    <div class="w-10 h-10 bg-white/5 rounded-md flex items-center justify-center mx-auto mb-2">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-gray-500">
                                            <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>
                                        </svg>
                                    </div>
                                    <p class="text-gray-400 text-sm">Henüz paylaşılan cümle yok.</p>
                                    <p class="text-gray-500 text-xs mt-1">İlk sen ol!</p>
                                </div>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error loading shared sentences:', error);
                });
        }

        function regenerateExamples() {
            const wordId = {{ word.id }};
            const container = document.getElementById('example-sentences');
            
            // Show loading state
            const loadingHTML = '<div class="example-card rounded-lg p-4"><p class="text-white mb-2">Dil seviyenize göre yeni örnek cümleler üretiliyor...</p></div>';
            container.innerHTML = loadingHTML;
            
            // Call the API with force_regenerate parameter
            fetch(`/load_examples/${wordId}?force_regenerate=true`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.examples) {
                        container.innerHTML = '';
                        
                        // Display examples in pairs (English and Turkish)
                        for (let i = 0; i < data.examples.length; i += 2) {
                            const div = document.createElement('div');
                            div.className = 'example-card rounded-lg p-4 hover:scale-[1.02] transition-transform';
                            
                            const englishP = document.createElement('p');
                            englishP.className = 'text-white mb-2';
                            englishP.textContent = data.examples[i];
                            
                            const turkishP = document.createElement('p');
                            turkishP.className = 'text-gray-400 text-sm';
                            turkishP.textContent = data.examples[i + 1];
                            
                            div.appendChild(englishP);
                            div.appendChild(turkishP);
                            container.appendChild(div);
                        }
                        
                        // Show success toast
                        showToast('Örnek cümleler dil seviyenize göre yeniden üretildi.', 'success');
                    } else if (!data.success && data.error) {
                        // Show limit error message and revert to original examples
                        fetch(`/load_examples/${wordId}`)
                            .then(response => response.json())
                            .then(originalData => {
                                if (originalData.success && originalData.examples) {
                                    container.innerHTML = '';
                                    for (let i = 0; i < originalData.examples.length; i += 2) {
                                        const div = document.createElement('div');
                                        div.className = 'example-card rounded-lg p-4 hover:scale-[1.02] transition-transform';
                                        
                                        const englishP = document.createElement('p');
                                        englishP.className = 'text-white mb-2';
                                        englishP.textContent = originalData.examples[i];
                                        
                                        const turkishP = document.createElement('p');
                                        turkishP.className = 'text-gray-400';
                                        turkishP.textContent = originalData.examples[i + 1];
                                        
                                        div.appendChild(englishP);
                                        div.appendChild(turkishP);
                                        container.appendChild(div);
                                    }
                                }
                            });
                        showToast('Bu kelime için seviye değişiminden sonra zaten örnek cümle yenilendi.', 'warning');
                    }
                })
                .catch(error => {
                    console.error('Error regenerating examples:', error);
                    container.innerHTML = '<div class="example-card rounded-lg p-4"><p class="text-red-400">Örnek cümleler yenilenemedi. Lütfen tekrar deneyin.</p></div>';
                    showToast('Örnek cümleler yenilenemedi. Lütfen tekrar deneyin.', 'error');
                });
        }

        function likeSentence(sentenceId) {
            fetch(`/like_sentence/${sentenceId}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Find the button and update like count
                    const button = document.querySelector(`button[onclick="likeSentence(${sentenceId})"]`);
                    if (button) {
                        const likeCount = button.querySelector('span');
                        likeCount.textContent = data.likes;
                    }
                }
            })
            .catch(error => {
                console.error('Error liking sentence:', error);
            });
        }

        function deleteSharedSentence(sentenceId) {
            // Show the modal
            const modal = document.getElementById('delete-sentence-modal');
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('active'), 10);
            
            // Set up event listeners
            document.getElementById('sentence-modal-cancel').onclick = function() {
                modal.classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 200);
            };
            
            document.getElementById('sentence-modal-delete').onclick = function() {
                // Hide the modal
                modal.classList.remove('active');
                setTimeout(() => modal.style.display = 'none', 200);
                
                // Delete the sentence
                fetch(`/delete_shared_sentence/${sentenceId}`, {
                    method: 'POST'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Remove the sentence from the UI
                        loadSharedSentences();
                    } else {
                        alert('Cümle silinirken hata oluştu: ' + (data.error || 'Bilinmeyen hata'));
                    }
                })
                .catch(error => {
                    console.error('Error deleting shared sentence:', error);
                    alert('Bağlantı hatası. Lütfen tekrar deneyin.');
                });
            };
        }

        // Kaydedilmiş durumunu kontrol et ve ayarla
        function checkSavedStatus() {
            fetch(`/is_saved/{{ word.id }}`)
                .then(response => response.json())
                .then(data => {
                    const saveBtn = document.getElementById('save-word-btn');
                    const saveText = document.getElementById('save-text');
                    
                    if (data.saved) {
                        saveBtn.classList.add('active');
                    } else {
                        saveBtn.classList.remove('active');
                    }
                })
                .catch(error => console.error('Error checking saved status:', error));
        }
        
        // Kaydet/Kayıttan çıkar
        async function toggleSaveWord(wordId) {
            try {
                const saveBtn = document.getElementById('save-word-btn');
                const isSaved = saveBtn.classList.contains('active');
                
                let response;
                if (isSaved) {
                    // Kayıttan çıkar
                    response = await fetch(`/unsave_word/${wordId}`, {
                        method: 'POST'
                    });
                } else {
                    // Kaydet
                    response = await fetch(`/save_word/${wordId}`, {
                        method: 'POST'
                    });
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Buton durumunu değiştir
                    saveBtn.classList.toggle('active');
                    
                    // Buton durumunu güncelle (sadece active class)
                }
            } catch (error) {
                console.error('Error:', error);
                showResult('Bağlantı hatası. Lütfen tekrar deneyin.', 'error');
            }
        }

        // Minimalist Toast notification function
        function showToast(message, type = 'success', duration = 4000) {
            // Create toast container if it doesn't exist
            let container = document.querySelector('.toast-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'toast-container';
                document.body.appendChild(container);
            }

            // Icon mapping
            const icons = {
                success: '✓',
                warning: '⚠',
                error: '✕'
            };

            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            toast.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">${icons[type] || icons.success}</div>
                    <div class="toast-text">${message}</div>
                    <button class="toast-close" onclick="this.closest('.toast').remove()">×</button>
                </div>
            `;

            // Add to container
            container.appendChild(toast);

            // Show with animation
            setTimeout(() => toast.classList.add('show'), 100);

            // Auto remove after duration
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, duration);

            // Remove on click
            toast.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            });
        }
    </script>

    <!-- Toast Container -->
    <div class="toast-container"></div>
</body>
</html> 